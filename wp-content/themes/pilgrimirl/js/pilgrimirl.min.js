!function(e){"use strict";e(document).ready(function(){!function(){const t=e(".mobile-menu-toggle"),n=e(".nav-menu");t.length&&n.length&&(t.on("click",function(t){t.preventDefault();const o="true"===e(this).attr("aria-expanded");e(this).attr("aria-expanded",!o),n.toggleClass("active"),o||function(e){const t=e.querySelectorAll('a[href], button, textarea, input[type="text"], input[type="radio"], input[type="checkbox"], select'),n=t[0],o=t[t.length-1];if(!n)return;e.addEventListener("keydown",function(e){"Tab"===e.key&&(e.shiftKey?document.activeElement===n&&(o.focus(),e.preventDefault()):document.activeElement===o&&(n.focus(),e.preventDefault()))}),n.focus()}(n[0])}),e(document).on("click",function(o){e(o.target).closest(".main-navigation").length||(t.attr("aria-expanded","false"),n.removeClass("active"))}),e(document).on("keydown",function(e){"Escape"===e.key&&n.hasClass("active")&&(t.attr("aria-expanded","false"),n.removeClass("active"),t.focus())}))}(),function(){const t=e("#pilgrim-search-form"),n=e("#pilgrim-search-input"),o=e("#filter-county"),i=e("#filter-post-type"),a=e("#reset-filters"),l=e("#pilgrim-search-results");let s;t.length&&(n.on("input",function(){clearTimeout(s);const t=e(this).val().trim();t.length>=2?s=setTimeout(()=>{c(t)},300):p()}),o.add(i).on("change",function(){const e=n.val().trim();e.length>=2?c(e):(o.val()||i.val())&&c("")}),a.on("click",function(){n.val(""),o.val(""),i.val(""),p()}),t.on("submit",function(e){e.preventDefault();c(n.val().trim())}));function c(t){u(),e.ajax({url:pilgrimirl_ajax.ajax_url,type:"POST",data:{action:"pilgrimirl_search",search_term:t,county:o.val(),post_type:i.val(),nonce:pilgrimirl_ajax.nonce},success:function(e){e.success?r(e.data):d("No results found")},error:function(e,t,n){console.error("Search error:",n),d("Search failed. Please try again.")}})}function r(e){const t=l;t.empty().show(),0!==e.length?e.forEach(function(e){const n=Array.isArray(e.county)?e.county.join(", "):"",o=`\n                    <div class="search-result-item" data-lat="${e.latitude}" data-lng="${e.longitude}">\n                        <h4><a href="${e.permalink}">${e.title}</a></h4>\n                        <p class="result-meta">\n                            <span class="post-type-label">${m(e.post_type)}</span>\n                            ${n?`<span class="county-label">${n}</span>`:""}\n                        </p>\n                        <p class="result-excerpt">${e.excerpt}</p>\n                        <div class="result-actions">\n                            <a href="${e.permalink}" class="read-more-btn">Read More</a>\n                            ${e.latitude&&e.longitude?'<button class="show-on-map-btn" onclick="showOnMap(this)">Show on Map</button>':""}\n                        </div>\n                    </div>\n                `;t.append(o)}):t.html('<div class="search-loading">No results found. Try adjusting your search terms.</div>')}function u(){l.html('<div class="search-loading">Searching...</div>').show()}function d(e){l.html('<div class="search-loading">'+e+"</div>").show()}function p(){l.hide().empty()}function m(e){return{monastic_site:"Monastic Site",pilgrimage_route:"Pilgrimage Route",christian_ruin:"Christian Ruin"}[e]||e}}(),e(".map-filter-btn").on("click",function(){const t=e(this),n=t.data("type");e(".map-filter-btn").removeClass("active"),t.addClass("active"),console.log("Filtering map by:",n),t.addClass("loading"),setTimeout(()=>{t.removeClass("loading")},500)}),e(".county-card").on("click",function(){const t=e(this).find(".county-link").attr("href");t&&(window.location.href=t)}),e(".county-card").on("keydown",function(t){"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),e(this).click())}),e(".county-card").attr("tabindex","0"),function(){if("IntersectionObserver"in window){const t=new IntersectionObserver(function(e){e.forEach(function(e){e.isIntersecting&&(e.target.classList.add("fade-in"),t.unobserve(e.target))})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});e(".feature-card, .county-card, .site-card").each(function(){t.observe(this)})}e('a[href^="#"]').on("click",function(t){const n=e(this.getAttribute("href"));n.length&&(t.preventDefault(),e("html, body").animate({scrollTop:n.offset().top-100},600))})}(),function(){function t(t){const n=e("<div>",{"aria-live":"polite","aria-atomic":"true",class:"sr-only"}).text(t);e("body").append(n),setTimeout(()=>n.remove(),1e3)}e(".sr-only").on("focus",function(){e(this).removeClass("sr-only").addClass("skip-link-focus")}).on("blur",function(){e(this).addClass("sr-only").removeClass("skip-link-focus")}),window.announceToScreenReader=t}()}),window.showOnMap=function(t){const n=e(t).closest(".search-result-item"),o=n.data("lat"),i=n.data("lng");if(o&&i){console.log("Showing location on map:",o,i);const t=e(".map-section");t.length&&e("html, body").animate({scrollTop:t.offset().top-100},600),window.announceToScreenReader&&window.announceToScreenReader("Location shown on map")}};let t=!1;function n(){t=!1}e(window).on("scroll",function(){t||(requestAnimationFrame(n),t=!0)}),window.addEventListener("error",function(e){console.error("PilgrimIRL Theme Error:",e.error)})}(jQuery),function(){"use strict";window.CSS&&CSS.supports("color","var(--fake-var)")||(document.documentElement.className+=" no-css-variables"),window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches&&(document.documentElement.className+=" reduce-motion")}(),window.initPilgrimMaps=function(){console.log("initPilgrimMaps called");document.querySelectorAll(".pilgrim-site-map").forEach(function(e){const t=parseFloat(e.getAttribute("data-lat")),n=parseFloat(e.getAttribute("data-lng")),o=e.getAttribute("data-title");if(t&&n){const i=new google.maps.Map(e,{center:{lat:t,lng:n},zoom:15,mapTypeId:"terrain"}),a=new google.maps.Marker({position:{lat:t,lng:n},map:i,title:o}),l=new google.maps.InfoWindow({content:"<h4>"+o+"</h4>"});a.addListener("click",function(){l.open(i,a)}),console.log("Site map initialized for:",o)}});const e=document.getElementById("pilgrim-main-map"),t=document.getElementById("counties-map");if(e||t){const n=e||t,o={lat:53.1424,lng:-7.6921};console.log("Creating main map on element:",n.id);const i=new google.maps.Map(n,{center:o,zoom:7,mapTypeId:"terrain",styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]});[{lat:53.3498,lng:-6.2603,title:"Dublin"},{lat:51.8985,lng:-8.4756,title:"Cork"},{lat:53.2707,lng:-9.0568,title:"Galway"},{lat:52.6638,lng:-8.6267,title:"Limerick"}].forEach(function(e){const t=new google.maps.Marker({position:{lat:e.lat,lng:e.lng},map:i,title:e.title,icon:{url:"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent('\n                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z" fill="#8B4513"/>\n                            <circle cx="12" cy="9" r="2.5" fill="white"/>\n                        </svg>\n                    '),scaledSize:new google.maps.Size(24,24),anchor:new google.maps.Point(12,24)}}),n=new google.maps.InfoWindow({content:'<div style="padding: 5px;"><strong>'+e.title+"</strong><br>Sample pilgrimage location</div>"});t.addListener("click",function(){n.open(i,t)})}),console.log("Google Maps initialized successfully on",n.id)}else console.log("No map container found")};