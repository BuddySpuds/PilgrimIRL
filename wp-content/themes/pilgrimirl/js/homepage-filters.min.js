!function(t){"use strict";let e={post_type:"pilgrimage_route",county:"",saint:"",century:""},n=[],s="grid";function o(){console.log("Initializing homepage filters"),t(".post-type-filters .filter-btn").removeClass("active"),t('.post-type-filters .filter-btn[data-type="pilgrimage_route"]').addClass("active"),console.log("Loading saints dropdown..."),t.ajax({url:pilgrimirl_ajax.ajax_url,type:"POST",data:{action:"get_filter_options",filter_type:"saints",nonce:pilgrimirl_ajax.nonce},success:function(e){console.log("Saints dropdown response:",e),e.success&&e.data.length>0?function(e){console.log("Rendering saints dropdown with",e.length,"saints");const n=t("#saints-select");n.find("option:not(:first)").remove(),e.forEach(function(e){const s=t("<option>").attr("value",e.slug).text(e.name+" ("+e.count+")");n.append(s)}),console.log("Saints dropdown rendered, total options:",n.find("option").length)}(e.data):console.log("No saints found or error loading options")},error:function(t,e,n){console.error("Error loading saints:",n)}}),a("centuries","#centuries-filters .filter-buttons"),a("counties","#counties-filters .filter-buttons"),console.log("Binding filter events..."),t(document).on("click",".post-type-filters .filter-btn",function(){const n=t(this).data("type");console.log("Post type filter clicked:",n),t(".post-type-filters .filter-btn").removeClass("active"),t(this).addClass("active"),e.post_type="all"===n?"":n,i()}),t(document).on("change","#saints-select",function(){const n=t(this).val(),s=t(this).find("option:selected").text();console.log("Saints dropdown changed! Value:",n,"Text:",s),console.log("Current filters before update:",e),e.saint=n,console.log("Current filters after update:",e),i()}),t(document).on("click",".filter-btn[data-filter-type]",function(){const n=t(this).data("filter-type"),s=t(this).data("value");switch(console.log("Taxonomy filter clicked:",n,s),t(this).siblings(".filter-btn").removeClass("active"),t(this).addClass("active"),n){case"centuries":e.century=s;break;case"counties":e.county=s}i()}),t(document).on("click",".clear-filters-btn",function(){e={post_type:"",county:"",saint:"",century:""},t(".filter-btn").removeClass("active"),t('.filter-btn[data-type="all"]').addClass("active"),t('.filter-btn[data-value=""]').addClass("active"),t("#saints-select").val(""),i()}),console.log("Filter events bound successfully"),t(document).on("click",".view-btn",function(){const e=t(this).data("view");t(".view-btn").removeClass("active"),t(this).addClass("active"),s=e,l(n)}),i(),setTimeout(function(){n.length>0&&d(n)},1e3)}function a(e,n){t.ajax({url:pilgrimirl_ajax.ajax_url,type:"POST",data:{action:"get_filter_options",filter_type:e,nonce:pilgrimirl_ajax.nonce},success:function(s){s.success&&s.data.length>0?function(e,n,s){const o=t(n),a=t("<button>").addClass("filter-btn").attr("data-filter-type",s).attr("data-value","").text("All "+(i=s,i.charAt(0).toUpperCase()+i.slice(1))).addClass("active");var i;o.append(a),e.forEach(function(e){const n=t("<button>").addClass("filter-btn").attr("data-filter-type",s).attr("data-value",e.slug).html(e.name+' <span class="count">('+e.count+")</span>");o.append(n)})}(s.data,n,e):console.log("No "+e+" found or error loading options")},error:function(t,n,s){console.error("Error loading "+e+":",s)}})}function i(){console.log("Loading filtered sites with filters:",e),t("#pilgrim-results").html('\n            <div class="results-loading">\n                <div class="loading-spinner"></div>\n                <p>Loading pilgrimage sites...</p>\n            </div>\n        '),t.ajax({url:pilgrimirl_ajax.ajax_url,type:"POST",data:{action:"get_filtered_sites",post_type:e.post_type,county:e.county,saint:e.saint,century:e.century,nonce:pilgrimirl_ajax.nonce},success:function(e){console.log("Filtered sites response:",e),e.success?(n=e.data,console.log("Found",n.length,"filtered sites"),l(n),function(e){const n=t(".results-count");0===e?n.html("No sites found"):1===e?n.html("Showing <strong>1</strong> site"):n.html("Showing <strong>"+e+"</strong> sites")}(n.length)):(console.error("Error loading filtered sites:",e),r())},error:function(t,e,n){console.error("AJAX error loading filtered sites:",n),r()}})}function l(e){const n=t("#pilgrim-results");n.empty(),0!==e.length?(n.removeClass("results-grid results-list").addClass("results-"+s),e.forEach(function(e){const s=function(e){const n={monastic_site:"Monastic Site",pilgrimage_route:"Pilgrimage Route",christian_site:"Christian Site"}[e.post_type]||e.post_type,s=Array.isArray(e.county)?e.county.join(", "):"",o=Array.isArray(e.saints)?e.saints.join(", "):"",a=Array.isArray(e.century)?e.century.join(", "):"",i=t("<div>").addClass("result-card"),l=t("<div>").addClass("result-card-image"),r=t("<div>").addClass("result-card-type").text(n);l.append(r);const d=t("<div>").addClass("result-card-content"),u=t("<h3>").addClass("result-card-title"),p=t("<a>").attr("href",e.permalink).text(c(e.title));u.append(p);const g=t("<div>").addClass("result-card-meta");s&&g.append(t("<span>").addClass("result-card-county").text("County "+s));o&&g.append(t("<span>").addClass("result-card-county").text("Saints: "+o));a&&g.append(t("<span>").addClass("result-card-county").text(a));const f=t("<p>").addClass("result-card-excerpt").text(c(e.excerpt||"Discover this historic site...")),m=t("<div>").addClass("result-card-actions"),y=t("<a>").addClass("result-card-link").attr("href",e.permalink).text("Learn More");if(m.append(y),e.latitude&&e.longitude){const n=t("<button>").addClass("result-card-map-btn").attr("data-lat",e.latitude).attr("data-lng",e.longitude).text("Show on Map").on("click",function(){!function(e){const n=parseFloat(t(e).data("lat")),s=parseFloat(t(e).data("lng"));if(t("#pilgrim-main-map").length&&"function"==typeof window.showOnMap)window.showOnMap(e);else{const t=`https://www.google.com/maps?q=${n},${s}`;window.open(t,"_blank")}}(this)});m.append(n)}return d.append(u,g,f,m),i.append(l,d),i}(e);n.append(s)}),d(e)):function(){const e=t("#pilgrim-results");e.html('\n            <div class="results-loading">\n                <p>No sites found matching your criteria.</p>\n                <button class="filter-btn clear-filters-btn">Clear All Filters</button>\n            </div>\n        ')}()}function r(){t("#pilgrim-results").html('\n            <div class="results-loading">\n                <p>Sorry, there was an error loading the sites. Please try again.</p>\n                <button class="filter-btn" onclick="location.reload()">Reload Page</button>\n            </div>\n        ')}function c(t){const e={"&#8216;":"'","&#8217;":"'","&#8220;":'"',"&#8221;":'"',"&#8211;":"–","&#8212;":"—","&#8230;":"…","&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&apos;":"'"};let n=t;for(const[t,s]of Object.entries(e))n=n.replace(new RegExp(t,"g"),s);return n}function d(t){"function"==typeof window.updateHomepageMap?(console.log("Updating homepage map with",t.length,"filtered sites"),window.updateHomepageMap(t)):console.log("Homepage map update function not available")}t(document).ready(function(){t(".pilgrim-filters-section").length>0?(console.log("Found filter section, initializing..."),o()):console.log("No filter section found on this page")})}(jQuery);