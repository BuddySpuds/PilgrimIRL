let pilgrimMaps={singleSiteMap:null,archiveMap:null,allSites:[],markers:[]};function initPilgrimMaps(){console.log("PilgrimIRL: Initializing maps..."),initSingleSiteMap(),initArchiveMap()}function initSingleSiteMap(){const e=document.getElementById("single-site-map");if(!e)return;const i=parseFloat(e.dataset.lat),a=parseFloat(e.dataset.lng),o=e.dataset.title,t=e.dataset.address;if(console.log("PilgrimIRL: Single site map data:",{lat:i,lng:a,title:o,address:t}),isNaN(i)||isNaN(a))return console.log("PilgrimIRL: Invalid coordinates for single site map"),void(e.innerHTML='<div class="map-error"><p>Location coordinates not available for this site.</p></div>');if("undefined"==typeof google||!google.maps)return console.log("PilgrimIRL: Google Maps not available"),void(e.innerHTML='<div class="map-error"><p>Map loading... Please ensure Google Maps API is configured.</p></div>');try{pilgrimMaps.singleSiteMap=new google.maps.Map(e,{center:{lat:i,lng:a},zoom:15,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]});const r=new google.maps.Marker({position:{lat:i,lng:a},map:pilgrimMaps.singleSiteMap,title:o,icon:{url:"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent('\n                    <svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">\n                        <circle cx="16" cy="16" r="12" fill="#2c5530" stroke="white" stroke-width="2"/>\n                        <text x="16" y="20" text-anchor="middle" fill="white" font-size="16" font-weight="bold">✝</text>\n                    </svg>\n                '),scaledSize:new google.maps.Size(32,32)}}),l=new google.maps.InfoWindow({content:`\n                <div style="max-width: 200px;">\n                    <h4 style="margin: 0 0 8px 0; color: #2c5530;">${o}</h4>\n                    ${t?`<p style="margin: 0; font-size: 0.9rem;">${t}</p>`:""}\n                </div>\n            `});r.addListener("click",()=>{l.open(pilgrimMaps.singleSiteMap,r)}),l.open(pilgrimMaps.singleSiteMap,r),console.log("PilgrimIRL: Single site map initialized successfully")}catch(i){console.error("PilgrimIRL: Error initializing single site map:",i),e.innerHTML='<div class="map-error"><p>Error loading map. Please try refreshing the page.</p></div>'}}function initArchiveMap(){const e=document.getElementById("archive-overview-map");if(e){if(console.log("PilgrimIRL: Initializing archive overview map"),"undefined"==typeof google||!google.maps)return console.log("PilgrimIRL: Google Maps not available for archive map"),void(e.innerHTML='<div class="map-error"><p>Map loading... Please ensure Google Maps API is configured.</p></div>');try{pilgrimMaps.archiveMap=new google.maps.Map(e,{center:{lat:53.1424,lng:-7.6921},zoom:7,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]}),loadAllSitesForMap(),console.log("PilgrimIRL: Archive overview map initialized successfully")}catch(i){console.error("PilgrimIRL: Error initializing archive map:",i),e.innerHTML='<div class="map-error"><p>Error loading overview map. Please try refreshing the page.</p></div>'}}}function loadAllSitesForMap(){pilgrimMaps.archiveMap&&jQuery.ajax({url:pilgrimirl_ajax.ajax_url,type:"POST",data:{action:"get_all_sites",nonce:pilgrimirl_ajax.nonce},success:function(e){e.success&&e.data?(pilgrimMaps.allSites=e.data,addMarkersToArchiveMap(e.data),console.log("PilgrimIRL: Loaded "+e.data.length+" sites for overview map")):console.error("PilgrimIRL: Failed to load sites for map")},error:function(e,i,a){console.error("PilgrimIRL: AJAX error loading sites:",a)}})}function addMarkersToArchiveMap(e){pilgrimMaps.archiveMap&&e&&(pilgrimMaps.markers.forEach(e=>e.setMap(null)),pilgrimMaps.markers=[],e.forEach(e=>{if(e.latitude&&e.longitude){const i=new google.maps.Marker({position:{lat:e.latitude,lng:e.longitude},map:pilgrimMaps.archiveMap,title:e.title,icon:{url:"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent('\n                        <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n                            <circle cx="12" cy="12" r="10" fill="#2c5530" stroke="white" stroke-width="2"/>\n                            <text x="12" y="16" text-anchor="middle" fill="white" font-size="12" font-weight="bold">✝</text>\n                        </svg>\n                    '),scaledSize:new google.maps.Size(24,24)}}),a=new google.maps.InfoWindow({content:`\n                    <div style="max-width: 250px;">\n                        <h4 style="margin: 0 0 8px 0; color: #2c5530;">\n                            <a href="${e.permalink}" style="color: #2c5530; text-decoration: none;">${e.title}</a>\n                        </h4>\n                        ${e.county&&e.county.length>0?`<p style="margin: 0 0 8px 0; font-size: 0.9rem; color: #666;">County: ${e.county[0]}</p>`:""}\n                        ${e.excerpt?`<p style="margin: 0; font-size: 0.9rem;">${e.excerpt}</p>`:""}\n                        <p style="margin: 8px 0 0 0;">\n                            <a href="${e.permalink}" style="color: #2c5530; font-weight: 500;">Learn More →</a>\n                        </p>\n                    </div>\n                `});i.addListener("click",()=>{a.open(pilgrimMaps.archiveMap,i)}),pilgrimMaps.markers.push(i)}}),console.log("PilgrimIRL: Added "+pilgrimMaps.markers.length+" markers to overview map"))}function showSiteOnArchiveMap(e,i,a){if(!pilgrimMaps.archiveMap){const o=document.getElementById("archive-map-section");return void(o&&(o.scrollIntoView({behavior:"smooth"}),setTimeout(()=>{initArchiveMap(),setTimeout(()=>{pilgrimMaps.archiveMap&&showSiteOnArchiveMap(e,i,a)},1e3)},500)))}const o={lat:parseFloat(e),lng:parseFloat(i)};pilgrimMaps.archiveMap.setCenter(o),pilgrimMaps.archiveMap.setZoom(15);const t=pilgrimMaps.markers.find(e=>{const i=e.getPosition();return Math.abs(i.lat()-o.lat)<1e-4&&Math.abs(i.lng()-o.lng)<1e-4});t&&google.maps.event.trigger(t,"click");const r=document.getElementById("archive-map-section");r&&r.scrollIntoView({behavior:"smooth"})}function filterArchiveMapMarkers(){if(!pilgrimMaps.archiveMap||!pilgrimMaps.allSites)return;const e=document.getElementById("archive-county-filter")?.value||"";document.getElementById("archive-site-type-filter"),document.getElementById("archive-period-filter");addMarkersToArchiveMap(pilgrimMaps.allSites.filter(i=>{let a=!0;return e&&i.county&&i.county.length>0&&(a=a&&i.county.some(i=>i.toLowerCase().replace(/\s+/g,"-")===e)),a}))}jQuery(document).ready(function(e){console.log("PilgrimIRL: DOM ready, checking for Google Maps..."),"undefined"!=typeof google&&google.maps?(console.log("PilgrimIRL: Google Maps already loaded, initializing..."),initPilgrimMaps()):console.log("PilgrimIRL: Waiting for Google Maps to load..."),e("#archive-county-filter, #archive-site-type-filter, #archive-period-filter").on("change",function(){setTimeout(filterArchiveMapMarkers,100)})}),window.initPilgrimMaps=initPilgrimMaps,window.showSiteOnArchiveMap=showSiteOnArchiveMap;