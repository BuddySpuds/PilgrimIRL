let pilgrimMaps={singleSiteMap:null,archiveMap:null,homepageMap:null,countyMap:null,allSites:[],markers:[],homepageMarkers:[]};function initPilgrimMaps(){console.log("PilgrimIRL: Initializing maps..."),initSingleSiteMap(),initArchiveMap(),initHomepageMap(),initCountiesMap(),initCountyMap()}function initSingleSiteMap(){const e=document.getElementById("single-site-map");if(!e)return;const i=parseFloat(e.dataset.lat),a=parseFloat(e.dataset.lng),n=e.dataset.title,o=e.dataset.address;if(console.log("PilgrimIRL: Single site map data:",{lat:i,lng:a,title:n,address:o}),isNaN(i)||isNaN(a))return console.log("PilgrimIRL: Invalid coordinates for single site map"),void(e.innerHTML='<div class="map-error"><p>Location coordinates not available for this site.</p></div>');if("undefined"==typeof google||!google.maps)return console.log("PilgrimIRL: Google Maps not available"),void(e.innerHTML='<div class="map-error"><p>Map loading... Please ensure Google Maps API is configured.</p></div>');try{pilgrimMaps.singleSiteMap=new google.maps.Map(e,{center:{lat:i,lng:a},zoom:15,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]});const t=new google.maps.Marker({position:{lat:i,lng:a},map:pilgrimMaps.singleSiteMap,title:n,icon:{url:"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent('\n                    <svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">\n                        <circle cx="16" cy="16" r="12" fill="#2c5530" stroke="white" stroke-width="2"/>\n                        <text x="16" y="20" text-anchor="middle" fill="white" font-size="16" font-weight="bold">✝</text>\n                    </svg>\n                '),scaledSize:new google.maps.Size(32,32)}}),l=new google.maps.InfoWindow({content:`\n                <div style="max-width: 200px;">\n                    <h4 style="margin: 0 0 8px 0; color: #2c5530;">${n}</h4>\n                    ${o?`<p style="margin: 0; font-size: 0.9rem;">${o}</p>`:""}\n                </div>\n            `});t.addListener("click",()=>{l.open(pilgrimMaps.singleSiteMap,t)}),l.open(pilgrimMaps.singleSiteMap,t),console.log("PilgrimIRL: Single site map initialized successfully")}catch(i){console.error("PilgrimIRL: Error initializing single site map:",i),e.innerHTML='<div class="map-error"><p>Error loading map. Please try refreshing the page.</p></div>'}}function initArchiveMap(){const e=document.getElementById("archive-overview-map");if(e){if(console.log("PilgrimIRL: Initializing archive overview map"),"undefined"==typeof google||!google.maps)return console.log("PilgrimIRL: Google Maps not available for archive map"),void(e.innerHTML='<div class="map-error"><p>Map loading... Please ensure Google Maps API is configured.</p></div>');try{pilgrimMaps.archiveMap=new google.maps.Map(e,{center:{lat:53.1424,lng:-7.6921},zoom:7,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]}),loadAllSitesForMap(),console.log("PilgrimIRL: Archive overview map initialized successfully")}catch(i){console.error("PilgrimIRL: Error initializing archive map:",i),e.innerHTML='<div class="map-error"><p>Error loading overview map. Please try refreshing the page.</p></div>'}}}function initHomepageMap(){const e=document.getElementById("pilgrim-main-map");if(e){if(console.log("PilgrimIRL: Initializing homepage map"),"undefined"==typeof google||!google.maps)return console.log("PilgrimIRL: Google Maps not available for homepage map"),void(e.innerHTML='<div class="map-error"><p>Map loading... Please ensure Google Maps API is configured.</p></div>');try{pilgrimMaps.homepageMap=new google.maps.Map(e,{center:{lat:53.1424,lng:-7.6921},zoom:7,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]}),console.log("PilgrimIRL: Homepage map initialized successfully")}catch(i){console.error("PilgrimIRL: Error initializing homepage map:",i),e.innerHTML='<div class="map-error"><p>Error loading map. Please try refreshing the page.</p></div>'}}else console.log("PilgrimIRL: Homepage map element not found")}function initCountiesMap(){const e=document.getElementById("counties-map");if(e){if(console.log("PilgrimIRL: Initializing counties overview map"),"undefined"==typeof google||!google.maps)return console.log("PilgrimIRL: Google Maps not available for counties map"),void(e.innerHTML='<div class="map-error"><p>Map loading... Please ensure Google Maps API is configured.</p></div>');try{const i=new google.maps.Map(e,{center:{lat:53.4129,lng:-7.9209},zoom:6.5,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]}),a={antrim:{lat:54.7197,lng:-6.2113,name:"Antrim"},armagh:{lat:54.3503,lng:-6.6528,name:"Armagh"},carlow:{lat:52.8408,lng:-6.9261,name:"Carlow"},cavan:{lat:53.9908,lng:-7.3606,name:"Cavan"},clare:{lat:52.9047,lng:-8.981,name:"Clare"},cork:{lat:51.8985,lng:-8.4756,name:"Cork"},derry:{lat:54.9966,lng:-7.3086,name:"Derry"},donegal:{lat:54.6538,lng:-8.1099,name:"Donegal"},down:{lat:54.3242,lng:-5.712,name:"Down"},dublin:{lat:53.3498,lng:-6.2603,name:"Dublin"},fermanagh:{lat:54.3454,lng:-7.6387,name:"Fermanagh"},galway:{lat:53.2707,lng:-8.8678,name:"Galway"},kerry:{lat:52.2593,lng:-9.5696,name:"Kerry"},kildare:{lat:53.158,lng:-6.911,name:"Kildare"},kilkenny:{lat:52.6541,lng:-7.2448,name:"Kilkenny"},laois:{lat:52.9944,lng:-7.3322,name:"Laois"},leitrim:{lat:54.0672,lng:-8.0145,name:"Leitrim"},limerick:{lat:52.6638,lng:-8.6267,name:"Limerick"},longford:{lat:53.7275,lng:-7.793,name:"Longford"},louth:{lat:53.938,lng:-6.4901,name:"Louth"},mayo:{lat:53.85,lng:-9.29,name:"Mayo"},meath:{lat:53.6055,lng:-6.6567,name:"Meath"},monaghan:{lat:54.2492,lng:-6.9683,name:"Monaghan"},offaly:{lat:53.236,lng:-7.7033,name:"Offaly"},roscommon:{lat:53.7585,lng:-8.2691,name:"Roscommon"},sligo:{lat:54.2697,lng:-8.4694,name:"Sligo"},tipperary:{lat:52.4739,lng:-8.1615,name:"Tipperary"},tyrone:{lat:54.5978,lng:-7.3055,name:"Tyrone"},waterford:{lat:52.2593,lng:-7.2924,name:"Waterford"},westmeath:{lat:53.5344,lng:-7.4653,name:"Westmeath"},wexford:{lat:52.3369,lng:-6.4633,name:"Wexford"},wicklow:{lat:52.9808,lng:-6.3663,name:"Wicklow"}};Object.keys(a).forEach(e=>{const n=a[e],o=new google.maps.Marker({position:{lat:n.lat,lng:n.lng},map:i,title:n.name,icon:{url:"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent('\n                        <svg width="28" height="28" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg">\n                            <circle cx="14" cy="14" r="11" fill="#2c5530" stroke="white" stroke-width="2.5"/>\n                            <text x="14" y="19" text-anchor="middle" fill="white" font-size="18" font-weight="bold">✝</text>\n                        </svg>\n                    '),scaledSize:new google.maps.Size(28,28)}}),t=new google.maps.InfoWindow({content:`\n                    <div style="max-width: 200px; padding: 8px;">\n                        <h4 style="margin: 0 0 12px 0; color: #2c5530; font-size: 1.125rem;">\n                            County ${n.name}\n                        </h4>\n                        <p style="margin: 0 0 12px 0; font-size: 0.9rem; color: #666;">\n                            Explore sacred sites in County ${n.name}\n                        </p>\n                        <a href="/county/${e}/"\n                           style="display: inline-block; background: #2c5530; color: white; padding: 8px 16px;\n                                  text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 0.9rem;">\n                            Explore ${n.name} →\n                        </a>\n                    </div>\n                `});o.addListener("click",()=>{t.open(i,o)}),o.addListener("dblclick",()=>{window.location.href="/county/"+e+"/"})}),console.log("PilgrimIRL: Counties overview map initialized with 32 county markers")}catch(i){console.error("PilgrimIRL: Error initializing counties map:",i),e.innerHTML='<div class="map-error"><p>Error loading counties map. Please try refreshing the page.</p></div>'}}}function initCountyMap(){const e=document.getElementById("county-map");if(!e)return;const i=e.dataset.county;if(console.log("PilgrimIRL: Initializing county map for:",i),"undefined"==typeof google||!google.maps)return console.log("PilgrimIRL: Google Maps not available for county map"),void(e.innerHTML='<div class="map-error"><p>Map loading... Please ensure Google Maps API is configured.</p></div>');const a={antrim:{lat:54.7197,lng:-6.2113},armagh:{lat:54.3503,lng:-6.6528},carlow:{lat:52.8408,lng:-6.9261},cavan:{lat:53.9908,lng:-7.3606},clare:{lat:52.9047,lng:-8.981},cork:{lat:51.8985,lng:-8.4756},derry:{lat:54.9966,lng:-7.3086},donegal:{lat:54.6538,lng:-8.1099},down:{lat:54.3242,lng:-5.712},dublin:{lat:53.3498,lng:-6.2603},fermanagh:{lat:54.3454,lng:-7.6387},galway:{lat:53.2707,lng:-8.8678},kerry:{lat:52.2593,lng:-9.5696},kildare:{lat:53.158,lng:-6.911},kilkenny:{lat:52.6541,lng:-7.2448},laois:{lat:52.9944,lng:-7.3322},leitrim:{lat:54.0672,lng:-8.0145},limerick:{lat:52.6638,lng:-8.6267},longford:{lat:53.7275,lng:-7.793},louth:{lat:53.938,lng:-6.4901},mayo:{lat:53.85,lng:-9.29},meath:{lat:53.6055,lng:-6.6567},monaghan:{lat:54.2492,lng:-6.9683},offaly:{lat:53.236,lng:-7.7033},roscommon:{lat:53.7585,lng:-8.2691},sligo:{lat:54.2697,lng:-8.4694},tipperary:{lat:52.4739,lng:-8.1615},tyrone:{lat:54.5978,lng:-7.3055},waterford:{lat:52.2593,lng:-7.2924},westmeath:{lat:53.5344,lng:-7.4653},wexford:{lat:52.3369,lng:-6.4633},wicklow:{lat:52.9808,lng:-6.3663}}[i]||{lat:53.4129,lng:-7.9209};try{pilgrimMaps.countyMap=new google.maps.Map(e,{center:a,zoom:9,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]}),console.log("PilgrimIRL: County map initialized, loading sites..."),jQuery.ajax({url:pilgrimirl_ajax.ajax_url,type:"POST",data:{action:"get_filtered_sites",county:i,post_type:"",nonce:pilgrimirl_ajax.nonce},success:function(a){a.success&&a.data?(console.log("PilgrimIRL: Loaded "+a.data.length+" sites for county "+i),addMarkersToCountyMap(a.data)):(console.error("PilgrimIRL: Failed to load sites for county"),e.innerHTML='<div class="map-error"><p>No sites found for this county.</p></div>')},error:function(i,a,n){console.error("PilgrimIRL: AJAX error loading county sites:",n),e.innerHTML='<div class="map-error"><p>Error loading map data. Please try refreshing the page.</p></div>'}}),console.log("PilgrimIRL: County map initialized successfully")}catch(i){console.error("PilgrimIRL: Error initializing county map:",i),e.innerHTML='<div class="map-error"><p>Error loading county map. Please try refreshing the page.</p></div>'}}function addMarkersToCountyMap(e){if(!pilgrimMaps.countyMap||!e)return;const i=new google.maps.LatLngBounds;let a=0;e.forEach(e=>{if(e.latitude&&e.longitude){const n=parseFloat(e.latitude),o=parseFloat(e.longitude);if(isNaN(n)||isNaN(o))return;let t="#2c5530";"pilgrimage_route"===e.post_type?t="#c8860d":"christian_site"===e.post_type&&(t="#8b4513");const l=new google.maps.Marker({position:{lat:n,lng:o},map:pilgrimMaps.countyMap,title:e.title,icon:{url:"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(`\n                        <svg width="28" height="28" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg">\n                            <circle cx="14" cy="14" r="11" fill="${t}" stroke="white" stroke-width="2.5"/>\n                            <text x="14" y="19" text-anchor="middle" fill="white" font-size="18" font-weight="bold">✝</text>\n                        </svg>\n                    `),scaledSize:new google.maps.Size(28,28)}}),r={monastic_site:"Monastic Site",pilgrimage_route:"Pilgrimage Route",christian_site:"Christian Site"}[e.post_type]||e.post_type,s=new google.maps.InfoWindow({content:`\n                    <div style="max-width: 280px; padding: 8px;">\n                        <div style="margin-bottom: 8px;">\n                            <span style="display: inline-block; padding: 4px 12px; background: ${t}; color: white;\n                                         border-radius: 12px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase;">\n                                ${r}\n                            </span>\n                        </div>\n                        <h4 style="margin: 0 0 8px 0; color: #2c5530; font-size: 1.125rem;">\n                            <a href="${e.permalink}" style="color: #2c5530; text-decoration: none;">${e.title}</a>\n                        </h4>\n                        ${e.excerpt?`<p style="margin: 0 0 12px 0; font-size: 0.9rem; color: #666;">${e.excerpt}</p>`:""}\n                        <a href="${e.permalink}"\n                           style="display: inline-block; background: ${t}; color: white; padding: 8px 16px;\n                                  text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 0.9rem;">\n                            Learn More →\n                        </a>\n                    </div>\n                `});l.addListener("click",()=>{s.open(pilgrimMaps.countyMap,l)}),i.extend(l.getPosition()),a++}}),a>0&&(1===a?pilgrimMaps.countyMap.setZoom(12):pilgrimMaps.countyMap.fitBounds(i)),console.log("PilgrimIRL: Added "+a+" markers to county map")}function updateHomepageMap(e){if(console.log("PilgrimIRL: updateHomepageMap called with",e?e.length:0,"sites"),!pilgrimMaps.homepageMap)return void console.log("PilgrimIRL: Homepage map not initialized yet");if(!e||0===e.length)return console.log("PilgrimIRL: No sites to display on map"),pilgrimMaps.homepageMarkers.forEach(e=>e.setMap(null)),void(pilgrimMaps.homepageMarkers=[]);pilgrimMaps.homepageMarkers.forEach(e=>e.setMap(null)),pilgrimMaps.homepageMarkers=[];const i=new google.maps.LatLngBounds;let a=0;e.forEach(e=>{if(e.latitude&&e.longitude){const n=parseFloat(e.latitude),o=parseFloat(e.longitude);if(isNaN(n)||isNaN(o))return;const t=new google.maps.Marker({position:{lat:n,lng:o},map:pilgrimMaps.homepageMap,title:e.title,icon:{url:"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent('\n                        <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n                            <circle cx="12" cy="12" r="10" fill="#2c5530" stroke="white" stroke-width="2"/>\n                            <text x="12" y="16" text-anchor="middle" fill="white" font-size="12" font-weight="bold">✝</text>\n                        </svg>\n                    '),scaledSize:new google.maps.Size(24,24)}}),l=new google.maps.InfoWindow({content:`\n                    <div style="max-width: 250px;">\n                        <h4 style="margin: 0 0 8px 0; color: #2c5530;">\n                            <a href="${e.permalink}" style="color: #2c5530; text-decoration: none;">${e.title}</a>\n                        </h4>\n                        ${e.county&&e.county.length>0?`<p style="margin: 0 0 8px 0; font-size: 0.9rem; color: #666;">County: ${e.county[0]}</p>`:""}\n                        ${e.excerpt?`<p style="margin: 0; font-size: 0.9rem;">${e.excerpt}</p>`:""}\n                        <p style="margin: 8px 0 0 0;">\n                            <a href="${e.permalink}" style="color: #2c5530; font-weight: 500;">Learn More →</a>\n                        </p>\n                    </div>\n                `});t.addListener("click",()=>{l.open(pilgrimMaps.homepageMap,t)}),pilgrimMaps.homepageMarkers.push(t),i.extend(t.getPosition()),a++}}),a>0&&(1===a?(pilgrimMaps.homepageMap.setCenter(pilgrimMaps.homepageMarkers[0].getPosition()),pilgrimMaps.homepageMap.setZoom(12)):pilgrimMaps.homepageMap.fitBounds(i)),console.log("PilgrimIRL: Added",a,"markers to homepage map")}function loadAllSitesForMap(){if(!pilgrimMaps.archiveMap)return;const e=document.getElementById("archive-overview-map"),i=e.dataset.postType||"",a=e.dataset.county||"",n=e.dataset.siteType||"",o=a||n,t={action:o?"get_filtered_sites":"get_all_sites",nonce:pilgrimirl_ajax.nonce};o&&(t.post_type=i,t.county=a,t.site_type=n,console.log("PilgrimIRL: Loading filtered sites for map:",t)),jQuery.ajax({url:pilgrimirl_ajax.ajax_url,type:"POST",data:t,success:function(e){e.success&&e.data?(pilgrimMaps.allSites=e.data,addMarkersToArchiveMap(e.data),console.log("PilgrimIRL: Loaded "+e.data.length+" sites for overview map"+(o?" (filtered)":""))):console.error("PilgrimIRL: Failed to load sites for map")},error:function(e,i,a){console.error("PilgrimIRL: AJAX error loading sites:",a)}})}function addMarkersToArchiveMap(e){pilgrimMaps.archiveMap&&e&&(pilgrimMaps.markers.forEach(e=>e.setMap(null)),pilgrimMaps.markers=[],e.forEach(e=>{if(e.latitude&&e.longitude){const i=new google.maps.Marker({position:{lat:e.latitude,lng:e.longitude},map:pilgrimMaps.archiveMap,title:e.title,icon:{url:"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent('\n                        <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n                            <circle cx="12" cy="12" r="10" fill="#2c5530" stroke="white" stroke-width="2"/>\n                            <text x="12" y="16" text-anchor="middle" fill="white" font-size="12" font-weight="bold">✝</text>\n                        </svg>\n                    '),scaledSize:new google.maps.Size(24,24)}}),a=new google.maps.InfoWindow({content:`\n                    <div style="max-width: 250px;">\n                        <h4 style="margin: 0 0 8px 0; color: #2c5530;">\n                            <a href="${e.permalink}" style="color: #2c5530; text-decoration: none;">${e.title}</a>\n                        </h4>\n                        ${e.county&&e.county.length>0?`<p style="margin: 0 0 8px 0; font-size: 0.9rem; color: #666;">County: ${e.county[0]}</p>`:""}\n                        ${e.excerpt?`<p style="margin: 0; font-size: 0.9rem;">${e.excerpt}</p>`:""}\n                        <p style="margin: 8px 0 0 0;">\n                            <a href="${e.permalink}" style="color: #2c5530; font-weight: 500;">Learn More →</a>\n                        </p>\n                    </div>\n                `});i.addListener("click",()=>{a.open(pilgrimMaps.archiveMap,i)}),pilgrimMaps.markers.push(i)}}),console.log("PilgrimIRL: Added "+pilgrimMaps.markers.length+" markers to overview map"))}function showSiteOnArchiveMap(e,i,a){if(!pilgrimMaps.archiveMap){const n=document.getElementById("archive-map-section");return void(n&&(n.scrollIntoView({behavior:"smooth"}),setTimeout(()=>{initArchiveMap(),setTimeout(()=>{pilgrimMaps.archiveMap&&showSiteOnArchiveMap(e,i,a)},1e3)},500)))}const n={lat:parseFloat(e),lng:parseFloat(i)};pilgrimMaps.archiveMap.setCenter(n),pilgrimMaps.archiveMap.setZoom(15);const o=pilgrimMaps.markers.find(e=>{const i=e.getPosition();return Math.abs(i.lat()-n.lat)<1e-4&&Math.abs(i.lng()-n.lng)<1e-4});o&&google.maps.event.trigger(o,"click");const t=document.getElementById("archive-map-section");t&&t.scrollIntoView({behavior:"smooth"})}function filterArchiveMapMarkers(){if(!pilgrimMaps.archiveMap||!pilgrimMaps.allSites)return;const e=document.getElementById("archive-county-filter")?.value||"";document.getElementById("archive-site-type-filter"),document.getElementById("archive-period-filter");addMarkersToArchiveMap(pilgrimMaps.allSites.filter(i=>{let a=!0;return e&&i.county&&i.county.length>0&&(a=a&&i.county.some(i=>i.toLowerCase().replace(/\s+/g,"-")===e)),a}))}jQuery(document).ready(function(e){console.log("PilgrimIRL: DOM ready, checking for Google Maps..."),"undefined"!=typeof google&&google.maps?(console.log("PilgrimIRL: Google Maps already loaded, initializing..."),initPilgrimMaps()):console.log("PilgrimIRL: Waiting for Google Maps to load..."),e("#archive-county-filter, #archive-site-type-filter, #archive-period-filter").on("change",function(){setTimeout(filterArchiveMapMarkers,100)})}),window.initPilgrimMaps=initPilgrimMaps,window.showSiteOnArchiveMap=showSiteOnArchiveMap,window.updateHomepageMap=updateHomepageMap;